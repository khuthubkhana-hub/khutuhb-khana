import{c as R,r as p,j as e,d as L,F as z,U as _,C as T,e as D,f as E,s as O,S as I,L as P,g as F,h as H}from"./index-Cjyo7cWJ.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],A=R("book",U),w=({icon:i,value:d,label:c,color:m})=>e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-neutral-200 shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full ${m}`,children:e.jsx(i,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-neutral-800",children:d}),e.jsx("p",{className:"text-sm font-medium text-neutral-500",children:c})]})]}),$=({books:i,members:d,circulation:c,categories:m})=>{const n=p.useMemo(()=>{const l=i.length,o=m.length,h=d.length,S=c.filter(s=>s.status==="issued").length,f=c.filter(s=>s.status==="issued"&&new Date(s.due_date)<new Date).length,j=m.map(s=>{const a=i.filter(g=>g.category_id===s.id).length;return{name:s.name,count:a}}).sort((s,a)=>a.count-s.count),v=i.reduce((s,a)=>{const g=a.language||"Unknown";return s[g]=(s[g]||0)+1,s},{}),C=Object.entries(v).map(([s,a])=>({name:s,count:a})).sort((s,a)=>a.count-s.count),b=c.reduce((s,a)=>(a.member_id&&(s[a.member_id]=(s[a.member_id]||0)+1),s),{}),y=Object.entries(b).sort(([,s],[,a])=>a-s)[0],k=y?d.find(s=>s.id===y[0]):null,B=y?y[1]:0,t=c.reduce((s,a)=>(a.book_id&&(s[a.book_id]=(s[a.book_id]||0)+1),s),{}),r=Object.entries(t).sort(([,s],[,a])=>a-s)[0],x=r?i.find(s=>s.id===r[0]):null,u=r?r[1]:0;return{totalBooks:l,totalCategories:o,totalMembers:h,booksIssued:S,booksOverdue:f,booksPerCategory:j,languageStats:C,topMember:k?{...k,count:B}:null,topBook:x?{...x,count:u}:null}},[i,d,c,m]),N=()=>{var h;const l=(h=document.getElementById("statistics-printable-area"))==null?void 0:h.innerHTML;if(!l)return;const o=window.open("","","height=800,width=1000");o&&(o.document.write("<html><head><title>Library Statistics Report</title>"),o.document.write(`
            <style>
              body { font-family: sans-serif; padding: 2rem; color: #334155; }
              h1 { font-size: 24px; margin-bottom: 2rem; text-align: center; color: #0f172a; }
              h2 { font-size: 18px; margin-top: 2rem; margin-bottom: 1rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; }
              .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem; }
              .grid-item { background-color: #f8fafc; border: 1px solid #e2e8f0; padding: 1rem; border-radius: 0.5rem; text-align: center; }
              .grid-item strong { font-size: 2rem; color: #14B8A6; display: block; }
              table { width: 100%; border-collapse: collapse; font-size: 12px; }
              th, td { border: 1px solid #cbd5e1; padding: 8px; text-align: left; }
              th { background-color: #f1f5f9; }
            </style>
        `),o.document.write("</head><body>"),o.document.write(l),o.document.write("</body></html>"),o.document.close(),o.focus(),o.print())};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-secondary-dark",children:"Library Statistics"}),e.jsxs("button",{onClick:N,className:"bg-primary text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm hover:bg-primary-dark",children:[e.jsx(L,{size:16})," Print Report"]})]}),e.jsxs("div",{id:"statistics-printable-area",children:[e.jsx("h1",{style:{display:"none"},children:"Library Statistics Report"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(w,{icon:A,value:n.totalBooks,label:"Total Books",color:"bg-primary"}),e.jsx(w,{icon:z,value:n.totalCategories,label:"Total Categories",color:"bg-blue-500"}),e.jsx(w,{icon:_,value:n.totalMembers,label:"Total Members",color:"bg-yellow-500"}),e.jsx(w,{icon:A,value:n.booksIssued,label:"Books Currently Issued",color:"bg-indigo-500"}),e.jsx(w,{icon:T,value:n.booksOverdue,label:"Books Overdue",color:"bg-accent"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8",children:[e.jsxs("div",{className:"bg-white rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Top Reader"}),n.topMember?e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-neutral-50 rounded-lg border",children:[e.jsx("div",{className:"p-3 bg-yellow-100 text-yellow-600 rounded-full",children:e.jsx(D,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:n.topMember.name}),e.jsxs("p",{className:"text-sm text-neutral-500",children:[n.topMember.class||"N/A"," - Reg: ",n.topMember.register_number||"N/A"]})]}),e.jsxs("p",{className:"ml-auto text-2xl font-bold text-yellow-600",children:[n.topMember.count," ",e.jsx("span",{className:"text-sm font-medium",children:"books"})]})]}):e.jsx("p",{className:"text-neutral-500",children:"No borrowing activity recorded."})]}),e.jsxs("div",{className:"bg-white rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Most Borrowed Book"}),n.topBook?e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-neutral-50 rounded-lg border",children:[e.jsx("div",{className:"p-3 bg-primary/20 text-primary-dark rounded-full",children:e.jsx(E,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:n.topBook.title}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["by ",n.topBook.author]})]}),e.jsxs("p",{className:"ml-auto text-2xl font-bold text-primary",children:[n.topBook.count," ",e.jsx("span",{className:"text-sm font-medium",children:"times"})]})]}):e.jsx("p",{className:"text-neutral-500",children:"No borrowing activity recorded."})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Books per Category"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Number of Books"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:n.booksPerCategory.map(l=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-900",children:l.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-500",children:l.count})]},l.name))})]})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Books per Language"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Language"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Number of Books"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:n.languageStats.map(l=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-900",children:l.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-500",children:l.count})]},l.name))})]})})]})]})]})},W=()=>{const[i,d]=p.useState([]),[c,m]=p.useState(!0),[n,N]=p.useState(null),[l,o]=p.useState(""),[h,S]=p.useState("all"),[f,j]=p.useState(new Set),v=p.useCallback(async()=>{m(!0),N(null);try{const{data:t,error:r}=await O.from("circulation").select("*, books(title), members(name, class)").order("issue_date",{ascending:!1});if(r)throw r;d(t||[])}catch(t){console.error("Error fetching member activity:",t),N("Failed to load member activity data.")}finally{m(!1)}},[]);p.useEffect(()=>{v()},[v]);const C=()=>{var x,u;if(!((x=document.getElementById("activity-report-printable"))==null?void 0:x.innerHTML))return;const r=window.open("","","height=800,width=1000");if(r){r.document.write("<html><head><title>Member Activity Report</title>"),r.document.write(`
            <style>
              body { font-family: sans-serif; padding: 2rem; }
              h1 { font-size: 24px; margin-bottom: 1rem; text-align: center; }
              table { width: 100%; border-collapse: collapse; font-size: 10px; }
              th, td { border: 1px solid #d1d5db; padding: 6px; text-align: left; }
              th { background-color: #f3f4f6; }
              .status-returned { color: #059669; }
              .status-issued { color: #3b82f6; }
              .status-overdue { color: #ef4444; font-weight: bold; }
              .no-print { display: none; }
            </style>
        `),r.document.write("</head><body><h1>Member Activity Report</h1>");const s=(u=document.getElementById("activity-report-printable"))==null?void 0:u.cloneNode(!0);s.querySelectorAll(".no-print").forEach(a=>a.remove()),r.document.write(s.innerHTML),r.document.write("</body></html>"),r.document.close(),r.focus(),r.print()}},b=i.filter(t=>{const r=t.status==="issued"&&new Date(t.due_date)<new Date;return h==="all"?!0:h==="overdue"?r:t.status===h}).filter(t=>{var x,u,s,a,g,M;if(!l)return!0;const r=l.toLowerCase();return((u=(x=t.books)==null?void 0:x.title)==null?void 0:u.toLowerCase().includes(r))||((a=(s=t.members)==null?void 0:s.name)==null?void 0:a.toLowerCase().includes(r))||((M=(g=t.members)==null?void 0:g.class)==null?void 0:M.toLowerCase().includes(r))}),y=t=>{const r=new Set(f);r.has(t)?r.delete(t):r.add(t),j(r)},k=()=>{f.size===b.length?j(new Set):j(new Set(b.map(t=>t.id)))},B=t=>{if(t.status==="issued"&&new Date(t.due_date)<new Date)return e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-accent/10 text-accent-dark status-overdue",children:"Overdue"});switch(t.status){case"returned":return e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-primary/10 text-primary-dark status-returned",children:"Returned"});case"issued":return e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 status-issued",children:"Issued"});default:return e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-neutral-100 text-neutral-800",children:t.status})}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-secondary-dark",children:"Member Borrowing History"}),e.jsxs("button",{onClick:C,className:"bg-primary text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm hover:bg-primary-dark",children:[e.jsx(L,{size:16})," Print Report"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 items-center mb-4 gap-4",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by book, member, or class...",value:l,onChange:t=>o(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-neutral-300 rounded-lg"})]}),e.jsx("div",{className:"flex items-center gap-2 bg-neutral-100 rounded-lg p-1 w-full sm:w-auto justify-self-start md:justify-self-end",children:["all","issued","returned","overdue"].map(t=>e.jsx("button",{onClick:()=>S(t),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors capitalize w-full text-center ${h===t?"bg-white text-primary shadow-sm":"text-neutral-600 hover:bg-neutral-200"}`,children:t},t))})]}),e.jsx("div",{id:"activity-report-printable",className:"overflow-x-auto",children:c?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(P,{className:"animate-spin text-primary",size:32})}):n?e.jsxs("div",{className:"text-center py-10 text-red-500",children:[e.jsx(F,{className:"mx-auto mb-2"}),n]}):b.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase no-print",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-neutral-300 text-primary focus:ring-primary",checked:f.size===b.length&&b.length>0,onChange:k})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"S.No."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Book Title"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Member"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Issued Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Return Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Fine"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:b.map((t,r)=>{var x,u,s,a;return e.jsxs("tr",{className:f.has(t.id)?"bg-primary/5":"",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap no-print",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-neutral-300 text-primary focus:ring-primary",checked:f.has(t.id),onChange:()=>y(t.id)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-neutral-500",children:r+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-900",children:((x=t.books)==null?void 0:x.title)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-500",children:((u=t.members)==null?void 0:u.name)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-500",children:((s=t.members)==null?void 0:s.class)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:B(t)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-500",children:new Date(t.issue_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-500",children:t.return_date?new Date(t.return_date).toLocaleDateString():"—"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-500",children:["₹",((a=t.fine_amount)==null?void 0:a.toFixed(2))||"0.00"]})]},t.id)})})]}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx(z,{size:40,className:"mx-auto text-neutral-300"}),e.jsx("p",{className:"mt-2 text-neutral-500",children:"No circulation history found for the selected criteria."})]})})]})},G=i=>{const[d,c]=p.useState("Statistics"),m=[{name:"Statistics",icon:H},{name:"Member Activity",icon:_}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center flex-wrap gap-4",children:e.jsx("h2",{className:"text-2xl font-bold text-secondary-dark",children:"Comprehensive Reports"})}),e.jsx("div",{className:"flex border-b border-neutral-200",children:m.map(n=>e.jsxs("button",{onClick:()=>c(n.name),className:`flex items-center gap-2 py-3 px-4 font-medium text-sm transition-colors ${d===n.name?"border-b-2 border-primary text-primary":"text-neutral-500 hover:text-neutral-700"}`,children:[e.jsx(n.icon,{size:16}),n.name]},n.name))}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-neutral-200",children:[d==="Statistics"&&e.jsx($,{...i}),d==="Member Activity"&&e.jsx(W,{})]})]})};export{G as default};
