import{r as s,j as e,X as P,L as v,s as u,B as E,P as A,S as L,a as F,T as z,b as D}from"./index-Cjyo7cWJ.js";const q=["Article","Book Review","Poem","Story"],M=["English","Kannada","Malayalam","Arabic","Urdu"],R=({post:l,onClose:g,onSave:j})=>{const[a,i]=s.useState({title:"",author:"",category:"Article",content:"",image_url:"",language:"English",author_image_url:""}),[x,p]=s.useState(!1),[c,f]=s.useState(null);s.useEffect(()=>{i(l?{title:l.title,author:l.author,category:l.category,content:l.content,image_url:l.image_url||"",language:l.language||"English",author_image_url:l.author_image_url||""}:{title:"",author:"",category:"Article",content:"",image_url:"",language:"English",author_image_url:""})},[l]);const m=async r=>{r.preventDefault(),p(!0),f(null);try{const{data:{user:d}}=await u.auth.getUser();if(!d)throw new Error("You must be logged in to perform this action.");const b={...a,user_id:d.id,image_url:a.image_url||null,author_image_url:a.author_image_url||null};let o;if(l?o=await u.from("read_with_us").update(b).eq("id",l.id):o=await u.from("read_with_us").insert(b),o.error)throw o.error;j()}catch(d){f(d.message||"An unexpected error occurred.")}finally{p(!1)}},n=a.category==="Book Review";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-neutral-200",children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-800",children:l?"Edit Post":"Add New Post"}),e.jsx("button",{onClick:g,className:"text-neutral-400 hover:text-neutral-600 transition-colors",children:e.jsx(P,{size:24})})]}),e.jsxs("form",{onSubmit:m,className:"flex-grow overflow-y-auto p-6 space-y-6",children:[c&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",children:c}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Title *"}),e.jsx("input",{id:"title",type:"text",required:!0,value:a.title,onChange:r=>i({...a,title:r.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md focus:ring-primary-light focus:border-primary-light"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"author",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Author *"}),e.jsx("input",{id:"author",type:"text",required:!0,value:a.author,onChange:r=>i({...a,author:r.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md focus:ring-primary-light focus:border-primary-light"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Category *"}),e.jsx("select",{id:"category",value:a.category,onChange:r=>i({...a,category:r.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md bg-white focus:ring-primary-light focus:border-primary-light",children:q.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Language *"}),e.jsx("select",{id:"language",value:a.language,onChange:r=>i({...a,language:r.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md bg-white focus:ring-primary-light focus:border-primary-light",children:M.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"author_image_url",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Author Image URL (Optional)"}),e.jsx("input",{id:"author_image_url",type:"url",value:a.author_image_url,onChange:r=>i({...a,author_image_url:r.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md focus:ring-primary-light focus:border-primary-light",placeholder:"https://example.com/author.png"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"image_url",className:"block text-sm font-medium text-neutral-700 mb-1",children:["Post Image URL ",n?"*":"(Optional)"]}),e.jsx("input",{id:"image_url",type:"url",required:n,value:a.image_url,onChange:r=>i({...a,image_url:r.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md focus:ring-primary-light focus:border-primary-light",placeholder:"https://example.com/image.png"}),n&&e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"An image is required for book reviews."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-neutral-700 mb-1",children:"Content *"}),e.jsx("textarea",{id:"content",required:!0,rows:8,value:a.content,onChange:r=>i({...a,content:r.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-md focus:ring-primary-light focus:border-primary-light"})]})]}),e.jsxs("div",{className:"p-4 border-t border-neutral-200 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:g,className:"px-5 py-2 bg-neutral-100 text-neutral-700 font-semibold rounded-lg hover:bg-neutral-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",onClick:m,disabled:x,className:"px-5 py-2 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark disabled:opacity-50 flex items-center justify-center min-w-[120px]",children:x?e.jsx(v,{className:"animate-spin"}):"Save Post"})]})]})})},T=()=>{const[l,g]=s.useState([]),[j,a]=s.useState(!0),[i,x]=s.useState(null),[p,c]=s.useState(!1),[f,m]=s.useState(null),[n,r]=s.useState(""),[d,b]=s.useState(1),[o]=s.useState(10),w=s.useCallback(async()=>{a(!0),x(null);try{const{data:t,error:h}=await u.from("read_with_us").select("*").order("created_at",{ascending:!1});if(h)throw h;g(t||[])}catch(t){x(t.message||"Failed to fetch posts.")}finally{a(!1)}},[]);s.useEffect(()=>{w();const t=u.channel("public:read_with_us").on("postgres_changes",{event:"*",schema:"public",table:"read_with_us"},w).subscribe();return()=>{u.removeChannel(t)}},[w]);const N=()=>{m(null),c(!0)},_=t=>{m(t),c(!0)},C=async t=>{if(window.confirm("Are you sure you want to delete this post? This action cannot be undone.")){const{error:h}=await u.from("read_with_us").delete().eq("id",t);h&&alert(`Error deleting post: ${h.message}`)}},k=()=>{c(!1),m(null)},y=s.useMemo(()=>l.filter(t=>t.title.toLowerCase().includes(n.toLowerCase())||t.author.toLowerCase().includes(n.toLowerCase())||t.category.toLowerCase().includes(n.toLowerCase())),[l,n]),S=s.useMemo(()=>{const t=(d-1)*o;return y.slice(t,t+o)},[y,d,o]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-neutral-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 flex-wrap gap-2",children:[e.jsxs("h3",{className:"text-xl font-bold text-neutral-800 flex items-center gap-2",children:[e.jsx(E,{size:22})," Read With Us Manager"]}),e.jsxs("button",{onClick:N,className:"bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm",children:[e.jsx(A,{size:16})," Add Post"]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by title, author, or category...",value:n,onChange:t=>r(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-neutral-300 rounded-lg"})]}),j?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(v,{className:"animate-spin text-primary",size:32})}):i?e.jsx("div",{className:"text-center py-10 text-red-500",children:i}):y.length===0?e.jsx("div",{className:"text-center py-10 text-neutral-500",children:"No posts found."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Title"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Author"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:S.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-neutral-900",children:t.title}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-neutral-500",children:t.author}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-neutral-500",children:t.category}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-neutral-500",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>_(t),className:"text-primary hover:text-primary-dark",title:"Edit Post",children:e.jsx(F,{size:18})}),e.jsx("button",{onClick:()=>C(t.id),className:"text-red-600 hover:text-red-900",title:"Delete Post",children:e.jsx(z,{size:18})})]})})]},t.id))})]})}),e.jsx(D,{currentPage:d,totalCount:y.length,pageSize:o,onPageChange:t=>b(t)})]})]}),p&&e.jsx(R,{post:f,onClose:()=>c(!1),onSave:k})]})};export{T as default};
